<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" type="text/css" href="grid12.css">
      <link rel="stylesheet" type="text/css" href="lite.css">
      <script src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>
      <script type="text/javascript">
         function getr()
                  {
              var N = Math.floor(parseFloat(document.calcit.dat1.value));
              var k = parseFloat(document.calcit.dat2.value);
              var covlo = parseFloat(document.calcit.dat3.value);
              var covhi = parseFloat(document.calcit.dat4.value);
              var nRuns = parseFloat(document.calcit.dat5.value);
           var cov=new Array();
           var reliability=0;
           for (iRun=1; iRun<=nRuns; iRun++) {
         var z = new Array();
         for (var i=0; i<=N-1; i++) {        z[i]=  jStat.randn(0,1);              }
         var sampmean=jStat.mean(z);
         var sampsd=jStat.stdev(z,true);
         var lolimit=sampmean-k*sampsd;
         var hilimit=sampmean+k*sampsd;
         cov[i]=jStat.normal.cdf(hilimit,0,1)-jStat.normal.cdf(lolimit,0,1);
         if(cov[i]<=covhi && cov[i]>=covlo) reliability=reliability+1
           }
         reliability=Math.round(reliability)/nRuns;
         
                      
var error1="";
var error2="";
var error3="";
var error4="";
var error5="";
var error6="";
var witherror=0;

if (N<2)   error1="Error type 1. Sample size should be an integer larger than 2 \n";
if (k<=0)   error2="Error type 2. K value should be positive, usually 2 or 3 \n";
if (covlo<0 || covlo>1)   error3="Error type 3. lower proximity limit should be between 0 and 1 \n"; 
if (covhi<0 || covhi>1)   error4="Error type 4. upper proximity limit should be between 0 and 1 \n"; 
if (covlo>=0 && covlo<=1 && covhi>=0 && covhi<=1 && covlo>=covhi) 
error5="Error type 5. lower proximity should be a smaller value than upper proximity value \n";
if  (nRuns<1) error6="Error type 6. the number of simulations should be a positive integer, ideally at least 10000 \n";
 

if (N<2)    witherror=1;
if (k<=0)   witherror=1;
if (covlo<0 || covlo>1)  witherror=1;
if (covhi<0 || covhi>1)  witherror=1;
if (covlo>=0 && covlo<=1 && covhi>=0 && covhi<=1 && covlo>=covhi) witherror=1;
if (nRuns<1) witherror=1;

if (witherror=1) finaloutput=error1+error2+error3+error4+error5+error6;
if (witherror=0) finaloutput= 
         "For a sample size of " + N + ", we define the control range as below: \n\n [(sample mean) +/- "+ k +" * (sample standard deviation)] \n\n "+
         "The following simulations assume that the population is normally distributed, and the sample is a random sample. "+
         "For each individual sample (1 simulation), we check whether the calculated control range covers "+
         "between "+ covlo +" and "+ covhi +" of the true population. After performing "+ nRuns +" simulations, "+ 
         "we check the proportion of them with control range covering between "+ covlo +" and "+ covhi +" of the true population. " +
         "This proportion is defined as the reliability value, which is "+ reliability + " here.";
                      
 document.getElementById("result").innerText=finaloutput;
         }
           
      </script>
   </head>
   <body>
      <div class="container-fluid">
         <div class="row">
            <div class="col-lg-2 col-md-2 col-sm-2">
            </div>
            
            <div class="col-lg-7 col-md-7 col-sm-7">
               <form name="calcit" onkeypress="return event.keyCode != 13;">
                  <h1 style="text-align: center"> Reliability Calculator </h1>
                  <table width="100%">
                     <tr>
                        <td style="text-align: right">Sample Size (such as 100):</td>
                        <td><input name="dat1" type="number" </td>
                     </tr>
                     <tr>
                        <td style="text-align: right">K (2 or 3):</td>
                        <td><input name="dat2" type="number"  </td>
                     </tr>
                     <tr>
                        <td style="text-align: right">Lower Proximity Limit (such as 0.94):</td>
                        <td><input name="dat3" type="number"  </td>
                     </tr>
                     <tr>
                        <td style="text-align: right">Higher Proximity Limit (such as 0.96):</td>
                        <td><input name="dat4" type="number"  </td>
                     </tr>
                     <tr>
                        <td style="text-align: right">Number of Simulations (10000 or more):</td>
                        <td><input name="dat5" type="number"  </td>
                     </tr>
                     <tr>
                        <td></td>
                        <td style="text-align: left"><input onclick="getr()" type="button" value="Calculate" ></td>
                     </tr>
                  </table>
                  <p style="text-align: center;"> <span style="color:blue; font-size:17px"  id="result" > </span></p>
            </div>
            </form>

         </div>
         <div class="col-lg-3 col-md-3 col-sm-3">        
         </div>
      </div>
      
               <div class="row"><div class="col-lg-2 col-md-2 col-sm-2"></div>
                  <div class="col-lg-7 col-md-7 col-sm-7"><ul>                     
               <li><a href="https://usp1210.github.io"> Home </a></li> 
               <li><a href="https://usp1210.github.io/reliability100.pdf"> Charts100 </a></li> 
               <li><a href="https://usp1210.github.io/reliability300.pdf"> Charts300 </a></li> 
               </ul></div><div class="col-lg-3 col-md-3 col-sm-3"></div></div>
      
      </div>
   </body>
</html>
